\definecolor{col1}{RGB}{255,0,0}
\definecolor{col2}{RGB}{0,255,0}
\definecolor{col3}{RGB}{0,0,255}

\newcommand{\SinCos}[4]{
    \begin{scope}[xscale=(5/#2)/2]
        \draw[color=#1!80,#3] (-1,0) sin (0,1) cos (1,0) sin (2,-1) cos (3,0) sin (4,1) cos (5,0) sin (6,-1) cos (7,0) sin (8,1) cos (9,0) sin (10,-1) cos (11,0) sin (12,1);
        \draw[color=#1!80!black,densely dash dot,xshift=28pt,#4] (-1,0) sin (0,1) cos (1,0) sin (2,-1) cos (3,0) sin (4,1) cos (5,0) sin (6,-1) cos (7,0) sin (8,1) cos (9,0) sin (10,-1) cos (11,0) sin (12,1);

        %        absolute value version
        %        \draw[color=#1!60] (-1,0) sin (0,1) cos (1,0) sin (2,1) cos (3,0) sin (4,1) cos (5,0) sin (6,1) cos (7,0) sin (8,1) cos (9,0) sin (10,1) cos (11,0) sin (12,1);
        %        \draw[color=#1!60!black, xshift=28pt] (-1,0) sin (0,1) cos (1,0) sin (2,1) cos (3,0) sin (4,1) cos (5,0) sin (6,1) cos (7,0) sin (8,1) cos (9,0) sin (10,1) cos (11,0) sin (12,1);
    \end{scope}
}

\begin{tikzpicture}[scale=0.9]
\begin{scope}[xshift=-150pt]
%    \begin{scope}[yshift=40pt] % Draw grid lines
%        \draw[help lines, color=red, dashed] (0,0) grid (5,5);
%        \draw[help lines, color=green, dashed] (0,0) grid[step=5/3] (5,5);
%        \draw[help lines, color=blue, dashed] (0,0) grid[step=5/2] (5,5);
%    \end{scope}
%

    \begin{scope}[rotate around={-90:(6.4,0)}, yscale=-1]
        \draw[<-] (-0.2,0) -- (5.2,0) node[below,name=y] {$y$};
        \draw[<->] (0,-1.3) -- (0,1.3);
        \draw (0,1) -- (-0.1,1) node[above] {1};
        \draw (0,-1) -- (-0.1,-1) node[above] {-1};
        \draw[<->] (5,-1.3) -- (5,1.3);
        \clip (0,-1.1) rectangle (5,1.1);
        \SinCos{red}{5}{}{ultra thick}
        \SinCos{green}{3}{}{ultra thick}
        \SinCos{blue}{2}{}{ultra thick}
    \end{scope}

    \begin{scope}
        \draw[<-] (-0.2,0) -- (5.2,0) node[right,name=x] {$x$};
        \draw[<->] (0,-1.3) -- (0,1.3);
        \draw (0,1) -- (-0.1,1) node[left] {1};
        \draw (0,-1) -- (-0.1,-1) node[left] {-1};
        \draw[<->] (5,-1.3) -- (5,1.3);

        \clip (0,-1.1) rectangle (5,1.1);

        \SinCos{red}{5}{}{ultra thick}
        \SinCos{green}{3}{}{ultra thick}
        \SinCos{blue}{2}{ultra thick}{}
    \end{scope}

    \draw (6.4,0) circle (3.5em) node[name=circ, text width=3em]{};
    \draw[thick] (6.4,0) circle (1.5em) node[align=center,below]{};
    \node at ($(circ.south)-(0,1.5cm)$) {\textit{positional\ encoding}};
    \draw[thick] ($(circ.center)$) to [controls=+(90:1em)and +(90:1em)] ($(circ.center)-(1.5em,0)$);
    \draw[thick] ($(circ.center)$) to [controls=+(-90:1em)and +(-90:1em)] ($(circ.center)+(1.5em,0)$);

    % draw kanji
    \input{figures/kanji-learn-svg.tex}

    % add selection grid
    \input{figures/grid-selection.tex}

\end{scope}

\begin{scope}[yshift=0,xshift=0+175,on background layer]
    \input{figures/concat-filters-3d.tex}
\end{scope}

\input{figures/feature-grid-3d.tex}

% TODO: ensure that these points exist on the concat-filters-3d
\begin{scope}[on background layer, out=-90,in=90,looseness=1.5, opacity=0.7]
    \draw[red!80!black, ultra thick, double distance=1pt] (red.mid) to (t1);
    \draw[green!80!black,ultra thick, double distance=1pt] (green.mid) to (t2);
    \draw[green!80!black,ultra thick, double distance=1pt] (green2.mid) to (t2);
    \draw[blue!80!black,ultra thick, double distance=1pt] (blue.mid) to (t3);
\end{scope}

\end{tikzpicture}
